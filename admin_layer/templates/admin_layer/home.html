{% extends "admin_layer/base_admin.html" %}

{% block content %}
<h1>Welcome to the Admin Panel</h1>

<!-- Financial Tracker Section -->
<section>
    <h2>Financial Tracker</h2>
    <p>Total Income: ${{ financial_tracker.total_income }}</p>
    <p>Total Expenses: ${{ financial_tracker.total_expenses }}</p>
    <p>Net Balance: ${{ net_balance|floatformat:2 }}</p>
</section>

<!-- Donation Tracker Section -->
<section>
    <h2>Donation Tracker</h2>
    <canvas id="donationChart" width="400" height="200"></canvas>
</section>

<!-- Upcoming Events Section -->
<section>
    <h2>Upcoming Events</h2>
    <ul>
        {% for event in upcoming_events %}
            <li>{{ event.title }} - {{ event.date|date:"F d, Y" }}</li>
        {% endfor %}
    </ul>
</section>

<!-- Include Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Render dynamic data using json_script for safe JS rendering -->
<script id="donationCategories" type="application/json">
    {{ donation_data.categories|json_script:"categories" }}
</script>
<script id="donationValues" type="application/json">
    {{ donation_data.values|json_script:"values" }}
</script>

<script>
    // Get the categories and values from the rendered JSON data
    const categories = JSON.parse(document.getElementById('donationCategories').textContent);
    const values = JSON.parse(document.getElementById('donationValues').textContent);

    // Initialize the chart
    const ctx = document.getElementById('donationChart').getContext('2d');
    const donationChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: categories,
            datasets: [{
                data: values,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
            }]
        }
    });
</script>
{% endblock %}
